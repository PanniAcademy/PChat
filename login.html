<!DOCTYPE html>
<html lang="en">
<head>
    <title>Login - PChat</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script src="firebase-config.js"></script>
    <link rel="stylesheet" href="login.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div id="loginContainer">
        <h2>Login to PChat</h2>
        <input type="text" id="phone" placeholder="Enter phone number (e.g., +1234567890)">
        <div id="recaptcha-container"></div>
        <button id="sendOTP" onclick="sendOTP()">Send OTP</button>
        
        <input type="text" id="otp" placeholder="Enter OTP">
        <button id="verifyOTP" onclick="verifyOTP()">Verify</button>
    </div>

    <script>
        let confirmationResult;

        // Initialize Firebase Authentication
        const auth = firebase.auth();

        // Initialize Recaptcha
        window.onload = function () {
            window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier("recaptcha-container", {
                size: "normal",
                callback: function(response) {
                    console.log("Recaptcha solved!", response);
                },
                "expired-callback": function() {
                    console.log("Recaptcha expired. Please solve it again.");
                }
            });
            recaptchaVerifier.render();
        };

        async function sendOTP() {
            try {
                let phone = document.getElementById("phone").value;
                if (!phone) {
                    alert("Please enter a valid phone number.");
                    return;
                }
                confirmationResult = await auth.signInWithPhoneNumber(phone, window.recaptchaVerifier);
                alert("OTP sent! Check your messages.");
                console.log("OTP sent to:", phone);
            } catch (error) {
                console.error("Error sending OTP:", error);
                alert("Error sending OTP: " + error.message);
            }
        }

        async function verifyOTP() {
            try {
                let otp = document.getElementById("otp").value;
                if (!otp) {
                    alert("Please enter the OTP.");
                    return;
                }
                let result = await confirmationResult.confirm(otp);
                alert("Login successful!");
                console.log("User signed in:", result.user);
                window.location.href = "contacts.html"; // Redirect after successful login
            } catch (error) {
                console.error("Error verifying OTP:", error);
                alert("Error verifying OTP: " + error.message);
            }
        }
    </script>
</body>
</html>
